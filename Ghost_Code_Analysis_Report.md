# Ghost Code Analysis Report

### Code Review Strategy
We adopted a checklist based code review strategy to analyze the code for any defects that may lead to critical security issues. While reviewing the code, we considered the admin part of Ghost application. Our main focus is on the external entities we had identified in our Threat model which are listed below.
* Login Module
* Theme Upload
* External API’s
* Mysql DB

Later we analyzed the code from the perspective of our Threat model and misuse cases, like privilege escalation, session hijacking ,API authentication ,Sql and Script injections. 

### Manual Code Review
From our threat report, we identified script injections, denial of service and input validation needed further investigation. Our main focus in manual code review process is to identify evidences that support the above security vulnerabilities.
In our manual code review, we narrowed down to the code modules related to the external entities where security vulnerabilities are possible. 
##### Login Module:  

Ghost implements default user authentication mechanism provided by Ember.js framework which handles all the security vulnerabilities. But we found unwanted function calls and imports which might lead to memory leak. 
##### Theme Upload:
When we analyzed Theme upload functionality provided by ghost at the code level, we saw that there is no validation mechanism implemented to verify the file upload. So, this might be potential security risk that has to be taken care by Ghost. 

```javascript
import ApplicationAdapter from './application';

export default ApplicationAdapter.extend({

    activate(model) {
        let url = `${this.buildURL('theme', model.get('id'))}activate/`;

        return this.ajax(url, 'PUT', {data: {}}).then((data) => {
            this.store.pushPayload(data);
            return model;
        });
    }

});
```
*Code snippet 1: Theme Upload code that directly stores theme into MySql DB without validation.*

##### External API’s:
The access to External APIs is prevented by implementing domain specific client authentication mechanism in Ghost.
##### Mysql DB:
We found no security vulnerabilities related to Mysql from our code analysis.

### Automated Static Analysis of the Code
The Static analysis of the code was done with the tools Plato and PMD. The Plato Report identified some Lint errors which are bad coding standards that should be avoided, but these were trivial and not related to our misuse cases or threat modeling. So, we used one more tool PMD, to further cross check and validate the report generated by Plato. The PMD report was more descriptive of the errors that it found. The result of the PMD report suggested that Ghost should avoid using global variables in its code base.

[Link to reports](https://drive.google.com/open?id=1UHbyFH6CTO5nvpLQB-vSeIFcROAWcij9)

### Summary of Key Findings
To summarize our analysis, we found that the code base had some code quality issues and it should avoid using global variables, from the static analysis report. From our manual code review we found that ghost is missing input validation at theme upload.

Our finding from the manual code review strategy related to theme upload can be mapped to Common weakness,[CWE--434: Unrestricted Upload of File with Dangerous Type](https://cwe.mitre.org/data/definitions/434.html) which lead to [CWE-183 Permissive Whitelist](https://cwe.mitre.org/data/definitions/183.html), [CWE-184: Incomplete Blacklist](https://cwe.mitre.org/data/definitions/184.html) and we mapped from the above  CWE to the following  attack pattern [CAPEC-73: User-Controlled Filename](https://capec.mitre.org/data/definitions/73.html).



